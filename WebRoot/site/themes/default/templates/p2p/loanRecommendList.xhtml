<ui:composition template="../page.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pm="http://primefaces.org/mobile"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:o="http://omnifaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:sec="http://www.springframework.org/security/facelets/tags">
	<ui:define name="content">
		
	<link type="text/css" rel="stylesheet" href="#{tplVars.themeStylePath}/css/list.css" />
	<link type="text/css" rel="stylesheet" href="#{tplVars.themeStylePath}/css/base.css" />
	<script type="text/javascript">	
	$(document).ready(function() {
		$(".ma").hide()
		$(".weixin").hover(function(){
		$(".ma").show()
		},function(){
		$(".ma").hide()
			});
		$(".t a").click(function(){
		$(".t a").css("background","#fff")
		$(".t a").css("color","#666");
		$(this).css("background","#3ec226");
		$(this).css("color","#fff");
		});
		$(".m a").click(function(){
		$(".m a").css("background","#fff")
		$(".m a").css("color","#666");
		$(this).css("background","#3ec226");
		$(this).css("color","#fff");
		});
		$(".b a").click(function(){
		$(".b a").css("background","#fff")
		$(".b a").css("color","#666");
		$(this).css("background","#3ec226");
		$(this).css("color","#fff");
		});
		$(".p1 a").css("background","#3ec226");
		$(".p1 a").css("color","#fff")
		$(".p1 a").css("border","1px solid #3ec226;");
		$(".pe a").click(function(){
		$(".pe a").css("background","#fff");
		$(".pe a").css("color","#5a5a5a");
		$(".pe a").css("border","1px solid #dddddd;");
		$(this).css("background","#3ec226");
		$(this).css("color","#fff");
		$(this).css("border","1px solid #dddddd;");
		});
		/* $('.progressbar').each(function(){
		var t = $(this),
		dataperc = t.attr('data-perc'),
		barperc = Math.round(dataperc*0.88);
		t.find('.bar').animate({width:barperc}, dataperc*25);
		t.find('.label').append('<div class="perc"></div>');
		function perc(){
			var length = t.find('.bar').css('width'),
			perc = Math.round(parseInt(length)/0.88),
			labelpos = (parseInt(length)-2);
			t.find('.perc').text(perc+'%');
		}
		perc();
		setInterval(perc, 0); 
	}); */
	});
	</script>
	
		<!-- <link type="text/css" rel="stylesheet"
			href="#{tplVars.themeStylePath}/p2p.css" /> -->
			
		<h:form>
		<p:remoteCommand process="@this" immediate="true" name="clearPage"
						actionListener="#{loanList.setCurrentPage(1)}"></p:remoteCommand>
						
			<!-- yanyan -->			
			<div id="main">
				<div class="main_inner">
		<p style=" padding-bottom:34px;">
		<a href="#{path}/" style="color:#666666">首页</a> > <a href="#" style="color:#666666">推荐项目列表</a></p>  
 						<div class="choice">
 							<p class="tit">筛选投资项目</p>
 					
 							<div class="choice_1 shai t">
				            	<p>项目收益：</p>
				                <ul>
				                	<li>
				                	<h:commandLink styleClass="all" title="全部" value="全部">
								<f:ajax render="dataTable"
									listener="#{loanList.setMinAndMaxRate(0.01,0.25)}"></f:ajax>
							</h:commandLink>
				                	</li>
				                    <li>
				                    <h:commandLink title="10%以下" value="10%以下">
								<f:ajax render="dataTable"
									listener="#{loanList.setMinAndMaxRate(0,0.1)}"></f:ajax>
							</h:commandLink>
				                    </li>
				                    <li><h:commandLink title="10%-15%" value="10%-15%">
								<f:ajax render="dataTable"
									listener="#{loanList.setMinAndMaxRate(0.1,0.15)}"></f:ajax>
							</h:commandLink>
							</li>
				                    <li><h:commandLink title="15%-20%" value="15%-20%">
								<f:ajax render="dataTable"
									listener="#{loanList.setMinAndMaxRate(0.15,0.2)}"></f:ajax>
							</h:commandLink>
							</li>
				                    <li><h:commandLink title="20%以上" value="20%以上">
								<f:ajax render="dataTable"
									listener="#{loanList.setMinAndMaxRate(0.2,10)}"></f:ajax>
							</h:commandLink>
							</li>
				                </ul>
				                <div class="clear"></div>
				            </div>
				            <div class="choice_1 shai m">
				            	<p>项目期限：</p>
				                <ul>
				                	<li><h:commandLink styleClass="all" title="全部" value="全部">
								<f:ajax render="dataTable"
									listener="#{loanList.setMinAndMaxDeadline(0,100)}">
								</f:ajax>
							</h:commandLink></li>
				                    <li><h:commandLink title="3个月以内" value="3个月以内">
								<f:ajax render="dataTable"
									listener="#{loanList.setMinAndMaxDeadline(0,3)}"></f:ajax>
							</h:commandLink></li>
				                    <li><h:commandLink title="3~6个月" value="3~6个月">
								<f:ajax render="dataTable"
									listener="#{loanList.setMinAndMaxDeadline(3,6)}"></f:ajax>
							</h:commandLink></li>
				                    <li><h:commandLink title="6~12个月" value="6~12个月">
								<f:ajax render="dataTable"
									listener="#{loanList.setMinAndMaxDeadline(6,12)}"></f:ajax>
							</h:commandLink></li>
				                    <li><h:commandLink title="12个月以上" value="12个月以上">
								<f:ajax render="dataTable"
									listener="#{loanList.setMinAndMaxDeadline(12,1000)}"></f:ajax>
							</h:commandLink></li>
				                </ul>
				                <div class="clear"></div>
				            </div>	
				            <div class="choice_1 b">
				            	<p>风险等级：</p>
				                <ul class="fengxian">
				                	<li><h:commandLink styleClass="all" title="全部" value="全部">
								<f:ajax render="dataTable"
									listener="#{loanList.example.setRiskLevel(null)}">
								</f:ajax>
							</h:commandLink></li>
				                    <li><h:commandLink title="AAA" value="AAA">
								<f:ajax render="dataTable"
									listener="#{loanList.example.setRiskLevel('AAA')}">
								</f:ajax>
							</h:commandLink></li>
				                    <li><h:commandLink title="AA" value="AA">
								<f:ajax render="dataTable"
									listener="#{loanList.example.setRiskLevel('AA')}">
								</f:ajax>
							</h:commandLink></li>
				                    <li><h:commandLink title="A" value="A">
								<f:ajax render="dataTable"
									listener="#{loanList.example.setRiskLevel('A')}">
								</f:ajax>
							</h:commandLink></li>
				                    <li><h:commandLink title="B" value="B">
								<f:ajax render="dataTable"
									listener="#{loanList.example.setRiskLevel('B')}">
								</f:ajax>
							</h:commandLink></li>
				                    <li><h:commandLink title="C" value="C">
								<f:ajax render="dataTable"
									listener="#{loanList.example.setRiskLevel('C')}">
								</f:ajax>
							</h:commandLink></li>
				                    <li><h:commandLink title="D" value="D">
								<f:ajax render="dataTable"
									listener="#{loanList.example.setRiskLevel('D')}">
								</f:ajax>
							</h:commandLink></li>
				                    <li><h:commandLink title="HR" value="HR">
								<f:ajax render="dataTable"
									listener="#{loanList.example.setRiskLevel('HR')}">
								</f:ajax>
							</h:commandLink></li>
				                </ul>
				            </div>
 					
 					</div>
						<!--筛选结束 -->
						<!--项目开始 -->
						<div class="project">
			            	<div class="pro_top">
			                	<p style="font-size:24px; margin-bottom:34px; float:left;">投资项目列表</p>
			                    <p style="float:left; padding-top:3px; margin-left:25px;"><a href="#{path}/invest-calculator" target="_blank"><img src="#{tplVars.themeImagePath}/img/list_1_03.jpg"/></a></p>	
			                    <div class="clear"></div>
			                </div>
			                <h:panelGroup id="dataTable">
			                <script type="text/javascript" src="#{tplVars.themeJSPath}/common_0.js"></script>
                			<div class="project_con">
			               		<ul class="p_t">
			                    	<li class="p_1">借款标题</li>
			                        <li class="p_2">风险等级</li>
			                        <li class="p_3">年利率</li>
			                        <li class="p_4">金额</li>
			                        <li class="p_5">期限</li>
			                        <li class="p_6">还款方式</li>
			                        <li class="p_7" style=" padding-left:28px;">进度</li>
			                        <li class="p_8" style=" padding-left:22px;">状态</li>
			                        <div class="clear"></div>
			                    </ul>
			                    <ui:param name="restriction"
								value="#{'(loan.status=\''}#{LoanStatus.RAISING}#{'\' or loan.status=\''}#{LoanStatus.COMPLETE}#{''}#{'\' or loan.status=\''}#{LoanStatus.RECHECK}#{'\' or loan.status=\''}#{LoanStatus.REPAYING}#{'\')'}"></ui:param>
							<f:event type="preRenderComponent"
								listener="#{loanList.addRestriction(restriction)}"></f:event>
							<f:event type="preRenderComponent" listener="#{loanList.addRestriction(' attr.id = \'recommend\'')}"></f:event>
							<f:event type="preRenderComponent"
								listener="#{loanList.setPageSize(10)}"></f:event>
							<f:event type="preRenderComponent"
								listener="#{loanList.example.setBusinessType('个人借款')}"></f:event>
							<ui:param name="orderColumn" value="#{'(case loan.status when \''}#{LoanStatus.RAISING}#{'\' then 1 when \''}#{LoanStatus.RECHECK}#{'\' then 2 when \''}#{LoanStatus.REPAYING}#{'\' then 3 else 4 end)'}"></ui:param>
				    		<f:event type="preRenderComponent"
				        		listener="#{loanList.addOrder(orderColumn, 'asc')}"></f:event>
				        	<f:event type="preRenderComponent"
								listener="#{loanList.addOrder('loan.seqNum','desc')}"></f:event>
							<f:event type="preRenderComponent"
								listener="#{loanList.addOrder('loan.commitTime','desc')}"></f:event>
							<ui:repeat var="loan" value="#{loanList.lazyModelData}">
			                    <ul class="p_b">
			                    	<li class="p_1"><a class="pname" href="#{path}/p2p_loan/#{loan.id}">#{stringHome.ellipsis(loan.name,6)}</a></li>
			                        <li class="p_2">
			                       <ui:fragment rendered="#{loan.riskLevel =='AAA'}">
										<img src="#{tplVars.themeImagePath}/img/list_3_11.jpg"/>	
									</ui:fragment>
			                       <ui:fragment rendered="#{loan.riskLevel =='AA'}">
										<img src="#{tplVars.themeImagePath}/img/list_4_11.jpg"/>	
									</ui:fragment>
			                       <ui:fragment rendered="#{loan.riskLevel =='A'}">
										<img src="#{tplVars.themeImagePath}/img/list_5_11.jpg"/>	
									</ui:fragment>
			                       <ui:fragment rendered="#{loan.riskLevel =='B'}">
										<img src="#{tplVars.themeImagePath}/img/list_6_11.jpg"/>	
									</ui:fragment>
			                       <ui:fragment rendered="#{loan.riskLevel =='C'}">
										<img src="#{tplVars.themeImagePath}/img/list_7_11.jpg"/>	
									</ui:fragment>
			                       <ui:fragment rendered="#{loan.riskLevel =='D'}">
										<img src="#{tplVars.themeImagePath}/img/list_8_11.jpg"/>	
									</ui:fragment>
			                       <ui:fragment rendered="#{loan.riskLevel =='HR'}">
										<img src="#{tplVars.themeImagePath}/img/list_9_11.jpg"/>	
									</ui:fragment>
			                        </li>
			                        <li class="p_3 lilv">
			                        <span>
			                        <h:outputText value="#{loan.ratePercent}">
										<f:convertNumber minFractionDigits="2" />
									</h:outputText></span>%
			                        </li>
			                        <li class="p_4"><span>
										<h:outputText value="#{loan.loanMoney}">
											<f:convertNumber type="number" />
										</h:outputText>
									</span>元</li>
			                        <li class="p_5">#{loan.deadline*loan.type.repayTimePeriod}(#{dictUtil.getValue('repay_unit',loan.type.repayTimeUnit)})</li>
									<li class="p_6">#{stringHome.ellipsis(dictUtil.getValue('repay_type',loan.type.repayType),4)}</li>
			                        <ui:param name="cr" value="#{loanCalculator.calculateRaiseCompletedRate(loan.id)}"></ui:param>
			                        <li class="p_7" style=" padding-top:40px; text-align:center">
			                        	<div class="progressbar" data-perc="#{cr}">
			                                <div class="bar color2"  style=" float:left;"><span></span></div>
			                                <div class="label"  style=" float:left;"></div>
			                                <div class="clear"></div>
			                            </div>
			                        </li>
			                        <li class="p_8">
			                        	<div class="zhuangtai">  
			                        	<ui:fragment rendered="#{loan.status ==LoanStatus.RAISING}">
											<a href="#{path}/loan/#{loan.id}" class="bnt_3 bnt">立即投标</a>
										</ui:fragment> 
										<ui:fragment rendered="#{loan.status !=LoanStatus.RAISING}">
											<a href="#{path}/loan/#{loan.id}" class="bnt_4 bnt2">#{dictUtil.getValue('loan',loan.status)}</a>
										</ui:fragment> 
			                               	<div class="clear"></div>
			                            </div>
			                        </li>
			                        <div class="clear"></div>
                    			</ul>
                    </ui:repeat>
                    <!-- <div class="page" style="border-top:1px solid #e6e6e6;">
                    	<ul>
                        	<li class="up_t"><a >«上一页</a></li>
                            <li class="pe p1"><a >1</a></li>
                            <li class="pe"><a >2</a></li>
                            <li class="pe"><a>3</a></li>
                            <li class="pe"><a>4</a></li>
                            <li class="pe"><a>...</a></li>
                            <li class="up_t"><a>下一页»</a></li>
                            <div class="clear"></div>
                        </ul>
                    </div> -->
                    <div class="pagebar">
							<ui:include src="#{tplVars.componentsPath}/loanPaging.xhtml"></ui:include>
						</div>
			                 </div>
			                 </h:panelGroup>
                		</div>
				</div>
			</div>
				<!-- *************************** -->		
		</h:form>
		<script type="text/javascript">
			$(".select-div .zt01 a").click(function() {
				$(this).parent().children().removeClass("hover");
				$(this).addClass("hover");
				//清除筛选对分页的影响
				clearPage();
			});
		</script>
	</ui:define>
</ui:composition>